<!DOCTYPE html>
<html>
    <head>
        <title>
            Prikaz vrsta
        </title>
        <!-- Bootstrap 5 CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">        
    </head>
    <body>
        
         <!-- Modal -->
         <div class="modal fade" id="addClassModal" tabindex="-1" aria-labelledby="addClassModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addClassModalLabel">Dodaj novu vrstu</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="addClassForm" method="POST" action="/kinds/add">
                            <div class="mb-3">
                                <label for="name" class="form-label">Ime</label>
                                <input type="text" class="form-control" id="name" name="name">
                            </div>
                            <div class="mb-3">
                                <label for="description" class="form-label">Opis</label>
                                <input type="text" class="form-control" id="description" name="description">
                            </div>        
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Zatvori</button>
                        <button type="button" class="btn btn-primary" id="addClassBtn">Dodaj vrstu</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="editClassModal" tabindex="-1" aria-labelledby="editClassModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addClassModalLabel">Uredi vrstu</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="addClassForm" method="POST" action="/kinds/add">
                            <div class="mb-3">
                                <label for="name" class="form-label">Ime</label>
                                <input type="text" class="form-control" id="godinaEdit" name="godinaEdit">
                            </div>
                            <div class="mb-3">
                                <label for="description" class="form-label">Opis</label>
                                <input type="hidden" class="form-control" id="razredIdEdit" name="razredIdEdit">
                                <input type="text" class="form-control" id="odjeljenjeEdit" name="odjeljenjeEdit">
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Zatvori</button>
                        <button type="button" class="btn btn-primary" id="editClassBtn">Uredi kind</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="container"  style="background-color: whitesmoke">
            <nav class="navbar navbar-expand-lg bg-body-tertiary">
                <div class="container-fluid">
                  <a class="navbar-brand" href="/"> 
                    <svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><path d="M226.5 92.9c14.3 42.9-.3 86.2-32.6 96.8s-70.1-15.6-84.4-58.5s.3-86.2 32.6-96.8s70.1 15.6 84.4 58.5zM100.4 198.6c18.9 32.4 14.3 70.1-10.2 84.1s-59.7-.9-78.5-33.3S-2.7 179.3 21.8 165.3s59.7 .9 78.5 33.3zM69.2 401.2C121.6 259.9 214.7 224 256 224s134.4 35.9 186.8 177.2c3.6 9.7 5.2 20.1 5.2 30.5v1.6c0 25.8-20.9 46.7-46.7 46.7c-11.5 0-22.9-1.4-34-4.2l-88-22c-15.3-3.8-31.3-3.8-46.6 0l-88 22c-11.1 2.8-22.5 4.2-34 4.2C84.9 480 64 459.1 64 433.3v-1.6c0-10.4 1.6-20.8 5.2-30.5zM421.8 282.7c-24.5-14-29.1-51.7-10.2-84.1s54-47.3 78.5-33.3s29.1 51.7 10.2 84.1s-54 47.3-78.5 33.3zM310.1 189.7c-32.3-10.6-46.9-53.9-32.6-96.8s52.1-69.1 84.4-58.5s46.9 53.9 32.6 96.8s-52.1 69.1-84.4 58.5z"/></svg>
                    </a>
                  <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                  </button>
                  <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                      <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="/">Ljubimci</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" href="/kinds">Vrste</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" href="/breeds">Pasmine</a>
                      </li>
                      <!--
                      <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                          Dropdown
                        </a>
                        <ul class="dropdown-menu">
                          <li><a class="dropdown-item" href="#">Action</a></li>
                          <li><a class="dropdown-item" href="#">Another action</a></li>
                          <li><hr class="dropdown-divider"></li>
                          <li><a class="dropdown-item" href="#">Something else here</a></li>
                        </ul>
                      </li>-->
                    </ul>
                    <form class="d-flex" role="search">
                    </form>
                  </div>
                </div>
              </nav>
            <div class="row mt-3 mb-3">
                <div class="col">
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addClassModal">
                        Dodaj vrstu
                    </button>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <table id="classesTbl" class="table table-bordered table-striped">
                        <thead class="table-dark">
                            <tr>
                                <th scope="col">ID</th>
                                <th scope="col">Ime</th>
                                <th scope="col">Opis</th>
                                <th scope="col">Akcije</th>
                            </tr>
                        </thead>
                        <tbody>
                        {% for kind in kinds %}
                            <tr id="row-{{ kind.id }}">
                                <td>{{ kind.id }}</td>
                                <td>{{ kind.name }}</td>
                                <td>{{ kind.description }}</td>
                                <td>
                                    <button class="btn btn-sm btn-danger deleteClassBtn" data-id="{{ kind.id }}">Briši</button>
                                    <button class="btn btn-sm btn-warning editClassBtn" data-id="{{ kind.id }}">Uredi</button>
                                    <a href="/kinds/{{ kind.id }}" class = "btn btn-sm btn-success">Redis</a>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <!-- Bootstrap 5 JavaScript Bundle with Popper -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.1.1/socket.io.js" integrity="sha512-oFOCo2/3DtjrJG4N27BjSLQWoiBv171sK6a+JiWjp/7agxC2nCUP358AqzxkBUb5jX8g6CYLPdSKQTbC0weCwA==" crossorigin="anonymous"></script>
    
        <script>
            $(document).ready(function() {
                var socket = io.connect('http://127.0.0.1:5000/kafka');

                $(document).on('click', '.editClassBtn', function() {
                    var id = $(this).data('id');

                    $.ajax({
                        type: "GET",
                        url: "/kinds/" + id,
                        success: function(data) {
                            $('#odjeljenjeEdit').val(data[0].description);
                            $('#godinaEdit').val(data[0].name);
                            $('#razredIdEdit').val(data[0].id);
                            $("#editClassModal").modal("show");
                        },
                        error: function(error) {
                            console.error('Nastala je greška:', error);
                        }
                    });
                });
                $(document).on('click', '#editClassBtn',function(event) {
                    event.preventDefault(); // Zaustavi formu 
                    var formData = {
                        id: $("#razredIdEdit").val(),
                        description: $("#odjeljenjeEdit").val(),
                        name: $("#godinaEdit").val()
                    };
                    $.ajax({
                        type: "PUT",
                        url: "/kinds/edit",
                        data: formData,
                        success: function(response) {
                            console.log("Kind uređen!");
                            $("#editClassModal").modal("hide");
                        },
                        error: function(error) {
                            console.error("Nastala je greška:", error);
                        }
                    });
                });
                $(document).on('click', '#addClassBtn',function(event) {
                    event.preventDefault(); // Zaustavi formu 
                    var formData = {
                        description: $("#description").val(),
                        name: $("#name").val()
                    };
                    $.ajax({
                        type: "POST",
                        url: "/kinds/add",
                        data: formData,
                        success: function(response) {
                            console.log("Kind dodan!");
                        },
                        error: function(error) {
                            console.error("Nastala je greška:", error);
                        }
                    });
                });

                $(document).on('click', '.deleteClassBtn', function() {
                    var row = $(this).closest('tr');
                    var id = $(this).data('id');
                    $.ajax({
                        type: "DELETE",
                        url: "/kinds/delete/" + id,
                        success: function(data) {
                            if (data.message) {
                                row.remove();
                            }
                        },
                        error: function(error) {
                            console.error('Nastala je greška:', error);
                        }
                    });
                });

                socket.on('connect', function() {
                    console.log('Connected to SocketIO server');
                });

                socket.on('data', function(msg) {
                    msg["kind"].forEach(function(kind) {
                        var table = $('#classesTbl'); // Identifikator tablice
                        var rowId = "row-" + kind.id;
                        var existingRow = $('#' + rowId);
                        
                        if (existingRow.length) {
                            existingRow.find('td:eq(1)').text(kind.name);
                            existingRow.find('td:eq(2)').text(kind.description);
                        } else {
                            // Dodaj novi redak
                            var row = $('<tr>').attr('id', rowId);
                            row.append($('<td>').text(kind.id));
                            row.append($('<td>').text(kind.name));
                            row.append($('<td>').text(kind.description));
                            
                            var deleteBtn = $('<button>').addClass('btn btn-sm btn-danger deleteClassBtn')
                                                        .attr('data-id', kind.id)
                                                        .text('Briši');
                            var editBtn = $('<button>').addClass('btn btn-sm btn-warning editClassBtn')
                                                        .attr('data-id', kind.id)
                                                        .text('Uredi');
                            var redisBtn = $('<button>').addClass('btn btn-sm btn-success redisBtn')
                                                        .attr('data-id', kind.id)
                                                        .text('Redis');
                            
                            var buttonsCell = $('<td>').append(deleteBtn, ' ', editBtn, ' ', redisBtn);
                            row.append(buttonsCell);
                            table.append(row);
                        }
                        
                        $("#addClassModal").modal("hide");
                    });
                });

            });

        </script>
    </body>
</html>
<style>
    body  {
        background-color: #bdbdbd;
    }
</style>